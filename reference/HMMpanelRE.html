<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="HMMpanelRE generates a sample from the posterior distribution of
the hidden Markov random-effects model discussed in Park (2011).
The code works for panel data with the same starting point.  The
sampling of panel parameters is based on Algorithm 2 of Chib and
Carlin (1999). This model uses a multivariate Normal prior for the
fixed effects parameters and varying individual effects, an
Inverse-Wishart prior on the random-effects parameters, an
Inverse-Gamma prior on the residual error variance, and Beta prior
for transition probabilities.  The user supplies data and priors,
and a sample from the posterior distribution is returned as an mcmc
object, which can be subsequently analyzed with functions provided
in the coda package."><title>Markov Chain Monte Carlo for the Hidden Markov Random-effects Model — HMMpanelRE • MCMCpack</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Fira_Mono-0.4.8/font.css" rel="stylesheet"><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Markov Chain Monte Carlo for the Hidden Markov Random-effects Model — HMMpanelRE"><meta property="og:description" content="HMMpanelRE generates a sample from the posterior distribution of
the hidden Markov random-effects model discussed in Park (2011).
The code works for panel data with the same starting point.  The
sampling of panel parameters is based on Algorithm 2 of Chib and
Carlin (1999). This model uses a multivariate Normal prior for the
fixed effects parameters and varying individual effects, an
Inverse-Wishart prior on the random-effects parameters, an
Inverse-Gamma prior on the residual error variance, and Beta prior
for transition probabilities.  The user supplies data and priors,
and a sample from the posterior distribution is returned as an mcmc
object, which can be subsequently analyzed with functions provided
in the coda package."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MCMCpack</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.6-3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Demonstration.html">Demonstration</a>
  </div>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://twitter.com/JNinnnngg" aria-label="Twitter">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Markov Chain Monte Carlo for the Hidden Markov Random-effects Model</h1>
      
      <div class="d-none name"><code>HMMpanelRE.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>HMMpanelRE generates a sample from the posterior distribution of
the hidden Markov random-effects model discussed in Park (2011).
The code works for panel data with the same starting point.  The
sampling of panel parameters is based on Algorithm 2 of Chib and
Carlin (1999). This model uses a multivariate Normal prior for the
fixed effects parameters and varying individual effects, an
Inverse-Wishart prior on the random-effects parameters, an
Inverse-Gamma prior on the residual error variance, and Beta prior
for transition probabilities.  The user supplies data and priors,
and a sample from the posterior distribution is returned as an mcmc
object, which can be subsequently analyzed with functions provided
in the coda package.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">HMMpanelRE</span><span class="op">(</span></span>
<span>  <span class="va">subject.id</span>,</span>
<span>  <span class="va">time.id</span>,</span>
<span>  <span class="va">y</span>,</span>
<span>  <span class="va">X</span>,</span>
<span>  <span class="va">W</span>,</span>
<span>  m <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  mcmc <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  burnin <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  thin <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  b0 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  B0 <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  c0 <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  d0 <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  <span class="va">r0</span>,</span>
<span>  <span class="va">R0</span>,</span>
<span>  a <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  b <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  beta.start <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  sigma2.start <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  D.start <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  P.start <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  marginal.likelihood <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"Chib95"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>subject.id</dt>
<dd><p>A numeric vector indicating the group number. It
should start from 1.</p></dd>


<dt>time.id</dt>
<dd><p>A numeric vector indicating the time unit. It should
start from 1.</p></dd>


<dt>y</dt>
<dd><p>The dependent variable</p></dd>


<dt>X</dt>
<dd><p>The model matrix of the fixed-effects</p></dd>


<dt>W</dt>
<dd><p>The model matrix of the random-effects. W should be a
subset of X.</p></dd>


<dt>m</dt>
<dd><p>The number of changepoints.</p></dd>


<dt>mcmc</dt>
<dd><p>The number of MCMC iterations after burn-in.</p></dd>


<dt>burnin</dt>
<dd><p>The number of burn-in iterations for the sampler.</p></dd>


<dt>thin</dt>
<dd><p>The thinning interval used in the simulation.  The
number of MCMC iterations must be divisible by this value.</p></dd>


<dt>verbose</dt>
<dd><p>A switch which determines whether or not the
progress of the sampler is printed to the screen.  If
<code>verbose</code> is greater than 0, the iteration number and the
posterior density samples are printed to the screen every
<code>verbose</code>th iteration.</p></dd>


<dt>b0</dt>
<dd><p>The prior mean of \(\beta\).  This can either be a
scalar or a column vector with dimension equal to the number of
betas. If this takes a scalar value, then that value will serve
as the prior mean for all of the betas.</p></dd>


<dt>B0</dt>
<dd><p>The prior precision of \(\beta\).  This can either be a
scalar or a square matrix with dimensions equal to the number of
betas.  If this takes a scalar value, then that value times an
identity matrix serves as the prior precision of beta. Default
value of 0 is equivalent to an improper uniform prior for beta.</p></dd>


<dt>c0</dt>
<dd><p>\(c_0/2\) is the shape parameter for the inverse Gamma
prior on \(\sigma^2\) (the variance of the disturbances). The
amount of information in the inverse Gamma prior is something
like that from \(c_0\) pseudo-observations.</p></dd>


<dt>d0</dt>
<dd><p>\(d_0/2\) is the scale parameter for the inverse Gamma
prior on \(\sigma^2\) (the variance of the disturbances). In
constructing the inverse Gamma prior, \(d_0\) acts like the sum
of squared errors from the \(c_0\) pseudo-observations.</p></dd>


<dt>r0</dt>
<dd><p>The shape parameter for the Inverse-Wishart prior on
variance matrix for the random effects. Set r=q for an
uninformative prior where q is the number of random effects</p></dd>


<dt>R0</dt>
<dd><p>The scale matrix for the Inverse-Wishart prior on
variance matrix for the random effects. This must be a square
q-dimension matrix. Use plausible variance regarding random
effects for the diagonal of R.</p></dd>


<dt>a</dt>
<dd><p>\(a\) is the shape1 beta prior for transition
probabilities.  By default, the expected duration is computed and
corresponding a and b values are assigned. The expected duration
is the sample period divided by the number of states.</p></dd>


<dt>b</dt>
<dd><p>\(b\) is the shape2 beta prior for transition
probabilities.  By default, the expected duration is computed and
corresponding a and b values are assigned. The expected duration
is the sample period divided by the number of states.</p></dd>


<dt>seed</dt>
<dd><p>The seed for the random number generator.  If NA,
current R system seed is used.</p></dd>


<dt>beta.start</dt>
<dd><p>The starting values for the beta vector. This can
either be a scalar or a column vector with dimension equal to the
number of betas.  The default value of NA will use draws from the
Uniform distribution with the same boundary with the data as the
starting value. If this is a scalar, that value will serve as the
starting value mean for all of the betas. When there is no
covariate, the log value of means should be used.</p></dd>


<dt>sigma2.start</dt>
<dd><p>The starting values for \(\sigma^2\). This
can either be a scalar or a column vector with dimension equal to
the number of states.</p></dd>


<dt>D.start</dt>
<dd><p>The starting values for the beta vector. This can
either be a scalar or a column vector with dimension equal to the
number of betas. The default value of NA will use draws from the
Uniform distribution with the same boundary with the data as the
starting value. If this is a scalar, that value will serve as the
starting value mean for all of the betas. When there is no
covariate, the log value of means should be used.</p></dd>


<dt>P.start</dt>
<dd><p>The starting values for the transition matrix. A
user should provide a square matrix with dimension equal to the
number of states. By default, draws from the <code>Beta(0.9,
0.1)</code> are used to construct a proper transition matrix for each
raw except the last raw.</p></dd>


<dt>marginal.likelihood</dt>
<dd><p>How should the marginal likelihood be
calculated?  Options are: <code>none</code> in which case the marginal
likelihood will not be calculated and <code>Chib95</code> in which case
the method of Chib (1995) is used.</p></dd>


<dt>...</dt>
<dd><p>further arguments to be passed</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>An mcmc object that contains the posterior sample. This
  object can be summarized by functions provided by the coda
  package.  The object contains an attribute <code>prob.state</code></p>


<p>storage matrix that contains the probability of \(state_i\) for
  each period, and the log-marginal likelihood of the model
  (<code>logmarglike</code>).</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>HMMpanelRE</code> simulates from the random-effect hidden Markov
panel model introduced by Park (2011).</p>
<p>The model takes the following form: $$y_i = X_i \beta_m + W_i
b_i + \varepsilon_i\;\; m = 1, \ldots, M$$ Where each group \(i\) have
\(k_i\) observations.  Random-effects parameters are assumed to
be time-varying at the system level: $$b_i \sim
\mathcal{N}_q(0, D_m)$$ $$\varepsilon_i \sim \mathcal{N}(0,
\sigma^2_m I_{k_i})$$</p>
<p>And the errors: We assume standard, conjugate priors: $$\beta
\sim \mathcal{N}_p(b0, B0)$$ And: $$\sigma^{2} \sim
\mathcal{IG}amma(c0/2, d0/2)$$ And: $$D \sim
\mathcal{IW}ishart(r0, R0)$$ See Chib and Carlin (1999) for more
details.</p>
<p>And: $$p_{mm} \sim \mathcal{B}eta(a, b),\;\; m = 1, \ldots, M$$
Where \(M\) is the number of states.</p>
<p><em>NOTE:</em> We do not provide default parameters for the priors on
the precision matrix for the random effects. When fitting one of
these models, it is of utmost importance to choose a prior that
reflects your prior beliefs about the random effects. Using the
<code>dwish</code> and <code>rwish</code> functions might be useful in choosing
these values.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Jong Hee Park, 2012. ``Unified Method for Dynamic and
  Cross-Sectional Heterogeneity: Introducing Hidden Markov Panel
  Models.''  <em>American Journal of Political Science</em>.56:
  1040-1054. &lt;doi: 10.1111/j.1540-5907.2012.00590.x&gt;</p>
<p>Siddhartha Chib. 1998. ``Estimation and comparison of multiple
  change-point models.'' <em>Journal of Econometrics</em>. 86:
  221-241. &lt;doi: 10.1016/S0304-4076(97)00115-2&gt;</p>
<p>Andrew D. Martin, Kevin M. Quinn, and Jong Hee Park. 2011.
``MCMCpack: Markov Chain Monte Carlo in R.'', <em>Journal of
Statistical Software</em>.  42(9): 1-21. <a href="https://doi.org/10.18637/jss.v042.i09" class="external-link">doi:10.18637/jss.v042.i09</a>
.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co">## data generating</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1977</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">Q</span> <span class="op">&lt;-</span> <span class="fl">3</span></span></span>
<span class="r-in"><span>  <span class="va">true.beta1</span>   <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span> ; <span class="va">true.beta2</span>   <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">true.sigma2</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span>; <span class="va">true.D1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="va">Q</span><span class="op">)</span>; <span class="va">true.D2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="va">Q</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">N</span><span class="op">=</span><span class="fl">30</span>; <span class="cn">T</span><span class="op">=</span><span class="fl">100</span>;</span></span>
<span class="r-in"><span>  <span class="va">NT</span> <span class="op">&lt;-</span> <span class="va">N</span><span class="op">*</span><span class="cn">T</span></span></span>
<span class="r-in"><span>  <span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">NT</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">NT</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">x1</span>, <span class="va">x2</span><span class="op">)</span>;   <span class="va">W</span> <span class="op">&lt;-</span> <span class="va">X</span>;   <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">NT</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## true break numbers are one and at the center</span></span></span>
<span class="r-in"><span>  <span class="va">break.point</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">T</span><span class="op">/</span><span class="fl">2</span>, <span class="va">N</span><span class="op">)</span>; <span class="va">break.sigma</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">N</span><span class="op">)</span><span class="op">)</span>;</span></span>
<span class="r-in"><span>  <span class="va">break.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">N</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">id</span>  <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">N</span>, each<span class="op">=</span><span class="va">NT</span><span class="op">/</span><span class="va">N</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">K</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>;</span></span>
<span class="r-in"><span>  <span class="va">ruler</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="cn">T</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## compute the weight for the break</span></span></span>
<span class="r-in"><span>  <span class="va">W.mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">T</span>, <span class="va">N</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">W.mat</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="op">(</span><span class="va">ruler</span><span class="op">-</span><span class="va">break.point</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="va">break.sigma</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="va">Weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">W.mat</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## data generating by weighting two means and variances</span></span></span>
<span class="r-in"><span>  <span class="va">j</span> <span class="op">=</span> <span class="fl">1</span></span></span>
<span class="r-in"><span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">Xi</span> <span class="op">&lt;-</span> <span class="va">X</span><span class="op">[</span><span class="va">j</span><span class="op">:</span><span class="op">(</span><span class="va">j</span><span class="op">+</span><span class="cn">T</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-in"><span>    <span class="va">Wi</span> <span class="op">&lt;-</span> <span class="va">W</span><span class="op">[</span><span class="va">j</span><span class="op">:</span><span class="op">(</span><span class="va">j</span><span class="op">+</span><span class="cn">T</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-in"><span>    <span class="va">true.V1</span> <span class="op">&lt;-</span> <span class="va">true.sigma2</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="cn">T</span><span class="op">)</span> <span class="op">+</span> <span class="va">Wi</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">true.D1</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">Wi</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">true.V2</span> <span class="op">&lt;-</span> <span class="va">true.sigma2</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="cn">T</span><span class="op">)</span> <span class="op">+</span> <span class="va">Wi</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">true.D2</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">Wi</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">true.mean1</span> <span class="op">&lt;-</span> <span class="va">Xi</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">true.beta1</span></span></span>
<span class="r-in"><span>    <span class="va">true.mean2</span> <span class="op">&lt;-</span> <span class="va">Xi</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">true.beta2</span></span></span>
<span class="r-in"><span>    <span class="va">weight</span> <span class="op">&lt;-</span> <span class="va">Weight</span><span class="op">[</span><span class="va">j</span><span class="op">:</span><span class="op">(</span><span class="va">j</span><span class="op">+</span><span class="cn">T</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span>    <span class="va">y</span><span class="op">[</span><span class="va">j</span><span class="op">:</span><span class="op">(</span><span class="va">j</span><span class="op">+</span><span class="cn">T</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">weight</span><span class="op">)</span><span class="op">*</span><span class="va">true.mean1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">weight</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/chol.html" class="external-link">chol</a></span><span class="op">(</span><span class="va">true.V1</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="cn">T</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>      <span class="va">weight</span><span class="op">*</span><span class="va">true.mean2</span> <span class="op">+</span> <span class="va">weight</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/chol.html" class="external-link">chol</a></span><span class="op">(</span><span class="va">true.V2</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="cn">T</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">j</span> <span class="op">&lt;-</span> <span class="va">j</span> <span class="op">+</span> <span class="cn">T</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="co">## model fitting</span></span></span>
<span class="r-in"><span>  <span class="va">subject.id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">N</span>, each<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">time.id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="cn">T</span>, <span class="va">N</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## model fitting</span></span></span>
<span class="r-in"><span>  <span class="va">G</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></span>
<span class="r-in"><span>  <span class="va">b0</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">K</span><span class="op">)</span> ; <span class="va">B0</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">100</span>, <span class="va">K</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">c0</span>  <span class="op">&lt;-</span> <span class="fl">2</span>; <span class="va">d0</span>  <span class="op">&lt;-</span> <span class="fl">2</span></span></span>
<span class="r-in"><span>  <span class="va">r0</span>  <span class="op">&lt;-</span> <span class="fl">5</span>; <span class="va">R0</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">subject.id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">N</span>, each<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">time.id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="cn">T</span>, <span class="va">N</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">out1</span> <span class="op">&lt;-</span> <span class="fu">HMMpanelRE</span><span class="op">(</span><span class="va">subject.id</span>, <span class="va">time.id</span>, <span class="va">y</span>, <span class="va">X</span>, <span class="va">W</span>, m<span class="op">=</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>                     mcmc<span class="op">=</span><span class="va">G</span>, burnin<span class="op">=</span><span class="va">G</span>, thin<span class="op">=</span><span class="fl">1</span>, verbose<span class="op">=</span><span class="va">G</span>,</span></span>
<span class="r-in"><span>                     b0<span class="op">=</span><span class="va">b0</span>, B0<span class="op">=</span><span class="va">B0</span>, c0<span class="op">=</span><span class="va">c0</span>, d0<span class="op">=</span><span class="va">d0</span>, r0<span class="op">=</span><span class="va">r0</span>, R0<span class="op">=</span><span class="va">R0</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## latent state changes</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="plotState.html">plotState</a></span><span class="op">(</span><span class="va">out1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## print mcmc output</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">out1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Website designed by Jianing Yao</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

