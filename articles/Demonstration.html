<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="MCMCpack">
<title>Demonstration â€¢ MCMCpack</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Fira_Mono-0.4.7/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Demonstration">
<meta property="og:description" content="MCMCpack">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MCMCpack</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.6-3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Demonstration.html">Demonstration</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://twitter.com/JNinnnngg" aria-label="Twitter">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Demonstration</h1>
                        <h4 data-toc-skip class="author">Jianing
Yao</h4>
            
      
      
      <div class="d-none name"><code>Demonstration.Rmd</code></div>
    </div>

    
    
<p>This vignette demonstrates the usage of <code>MCMCpack</code> on a
<code>TidyTuesday</code> dataset.</p>
<p><strong>Data</strong>: The Broadway Weekly Grosses data can be
obtained from <a href="https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-04-28/readme.md" class="external-link">TidyTuesday</a>.</p>
<p><strong>Question</strong>: This data contains information about
weekly box office grosses, attendance, ticket prices of shows presented
in Broadway theatres. What factors will impact weekly box office
revenues, e.g., ticket price, attendance, time of the year?</p>
<p><strong>Data dictionary</strong>: The data dictionary can be obtained
<a href="https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-04-28/readme.md" class="external-link">here</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## create `data` directory if it doesn't exist</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="st">"../data"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"../data"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">## download the TidyTuesday dataset only if it doesn't exist</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">"../data/grosses.rda"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">grosses</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-04-28/grosses.csv'</span>, guess_max <span class="op">=</span> <span class="fl">40000</span><span class="op">)</span></span>
<span>  <span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_data.html" class="external-link">use_data</a></span><span class="op">(</span><span class="va">grosses</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">"../data/synopses.rda"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">synopses</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-04-28/synopses.csv'</span><span class="op">)</span></span>
<span>  <span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_data.html" class="external-link">use_data</a></span><span class="op">(</span><span class="va">synopses</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">"../data/cpi.rda"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">cpi</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-04-28/cpi.csv'</span><span class="op">)</span></span>
<span>  <span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_data.html" class="external-link">use_data</a></span><span class="op">(</span><span class="va">cpi</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## load data set</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"../data/grosses.rda"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"../data/synopses.rda"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"../data/cpi.rda"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="data-wrangling-and-visualization">Data wrangling and visualization<a class="anchor" aria-label="anchor" href="#data-wrangling-and-visualization"></a>
</h3>
<p><strong>First, I selected data after year 2010 and created a dummy
variable to indicate whether the record is in holiday months (December
or January).</strong></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'lubridate'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     date, intersect, setdiff, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">grosses</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">week_ending</span><span class="op">)</span>,</span>
<span>         month <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html" class="external-link">month</a></span><span class="op">(</span><span class="va">week_ending</span><span class="op">)</span>,</span>
<span>         is_dec_or_jan <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">month</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">week_number</span>, <span class="op">-</span><span class="va">performances</span>, <span class="op">-</span><span class="va">previews</span>, <span class="op">-</span><span class="va">seats_sold</span>, <span class="op">-</span><span class="va">seats_in_theatre</span>, </span>
<span>         <span class="op">-</span><span class="va">potential_gross</span>, <span class="op">-</span><span class="va">top_ticket_price</span>, <span class="op">-</span><span class="va">show</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2010</span>, <span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>theatre <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">theatre</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>The plot below shows the trend of weekly gross from 2010 to
2020.</strong></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">week_ending</span>, y <span class="op">=</span> <span class="va">weekly_gross_overall</span><span class="op">/</span><span class="fl">100000</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Weekly Gross Over Time (per $100, 000)"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Week Ending"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Weekly Gross Overall (per $100, 000)"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Data Source: Broadway Grosses"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 year"</span>, date_labels <span class="op">=</span> <span class="st">"%Y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Demonstration_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<p><strong>The figure below shows the mean of weekly box office gross,
average ticket price, and percent of theatre capacity for individual
shows from 2010 to 2020.</strong></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="va">df_theatre</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">theatre</span>, <span class="va">weekly_gross</span>, <span class="va">avg_ticket_price</span>, <span class="va">pct_capacity</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">theatre</span><span class="op">)</span></span>
<span><span class="va">means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_dfr</a></span><span class="op">(</span><span class="va">df_theatre</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.x</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, .id <span class="op">=</span> <span class="st">"theatre"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">weekly_gross</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">means_long</span> <span class="op">&lt;-</span> <span class="va">means</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="va">theatre</span>, names_to <span class="op">=</span> <span class="st">"Metric"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Metric <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html" class="external-link">recode</a></span><span class="op">(</span><span class="va">Metric</span>,</span>
<span>                         weekly_gross <span class="op">=</span> <span class="st">"Weekly Gross"</span>,</span>
<span>                         avg_ticket_price <span class="op">=</span> <span class="st">"Average Ticket Price"</span>,</span>
<span>                         pct_capacity <span class="op">=</span> <span class="st">"Percent Capacity"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">means_long</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">theatre</span>, y <span class="op">=</span> <span class="va">value</span>, fill <span class="op">=</span> <span class="va">Metric</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Metric</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mean Theatre Metrics"</span>, x <span class="op">=</span> <span class="st">"Theatres"</span>, y <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,  </span>
<span>    axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,  </span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span></span>
<span>  <span class="op">)</span> </span></code></pre></div>
<p><img src="Demonstration_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="try-out-mcmcpack">Try out <code>MCMCpack</code><a class="anchor" aria-label="anchor" href="#try-out-mcmcpack"></a>
</h3>
<p><strong>Next, I tried out Bayesian linear regression using Markov
Chain Monte Carlo sampling algorithm with three predictors: average
ticket price, percent of theatre capacity, and whether happens in
holiday months. Weak priors are used for beta and sigma^2. Sub-models
are also fitted and compared with the full model based on Bayes factor
to select the best model.</strong></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://CRAN.R-project.org/package=MCMCpack" class="external-link">MCMCpack</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: coda</span></span>
<span><span class="co">#&gt; Loading required package: MASS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'MASS'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     select</span></span>
<span><span class="co">#&gt; ##</span></span>
<span><span class="co">#&gt; ## Markov Chain Monte Carlo Package (MCMCpack)</span></span>
<span><span class="co">#&gt; ## Copyright (C) 2003-2023 Andrew D. Martin, Kevin M. Quinn, and Jong Hee Park</span></span>
<span><span class="co">#&gt; ##</span></span>
<span><span class="co">#&gt; ## Support provided by the U.S. National Science Foundation</span></span>
<span><span class="co">#&gt; ## (Grants SES-0350646 and SES-0350613)</span></span>
<span><span class="co">#&gt; ##</span></span>
<span></span>
<span><span class="va">numeric_predictors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"avg_ticket_price"</span>, <span class="st">"pct_capacity"</span><span class="op">)</span></span>
<span><span class="va">df_bayes</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/modify.html" class="external-link">modify_at</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/one_of.html" class="external-link">one_of</a></span><span class="op">(</span><span class="va">numeric_predictors</span><span class="op">)</span><span class="op">)</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Using `vars()` in .at was deprecated in purrr 1.0.0.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span>
<span>  </span>
<span></span>
<span><span class="co">## MCMCpack</span></span>
<span><span class="co"># Define predictor combinations</span></span>
<span><span class="va">predictor_combinations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"avg_ticket_price"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pct_capacity"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"is_dec_or_jan"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"avg_ticket_price"</span>, <span class="st">"pct_capacity"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"avg_ticket_price"</span>, <span class="st">"is_dec_or_jan"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pct_capacity"</span>, <span class="st">"is_dec_or_jan"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"avg_ticket_price"</span>, <span class="st">"pct_capacity"</span>, <span class="st">"is_dec_or_jan"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_summaries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit models and store summaries in the list</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">combo</span> <span class="kw">in</span> <span class="va">predictor_combinations</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"weekly_gross ~"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">combo</span>, collapse <span class="op">=</span> <span class="st">" + "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MCMCregress.html">MCMCregress</a></span><span class="op">(</span><span class="va">formula</span>, data <span class="op">=</span> <span class="va">df_bayes</span>, B0 <span class="op">=</span> <span class="fl">10e-8</span>,</span>
<span>                       mcmc <span class="op">=</span> <span class="fl">10000</span>, marginal.likelihood<span class="op">=</span><span class="st">"Chib95"</span><span class="op">)</span></span>
<span>  <span class="va">summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span>  <span class="va">models</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">combo</span>, collapse <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">model</span></span>
<span>  <span class="va">model_summaries</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">combo</span>, collapse <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">summary</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">sub1</span> <span class="op">&lt;-</span> <span class="va">models</span><span class="op">$</span><span class="va">avg_ticket_price</span></span>
<span><span class="va">sub2</span> <span class="op">&lt;-</span> <span class="va">models</span><span class="op">$</span><span class="va">pct_capacity</span></span>
<span><span class="va">sub3</span> <span class="op">&lt;-</span> <span class="va">models</span><span class="op">$</span><span class="va">is_dec_or_jan</span></span>
<span><span class="va">sub4</span> <span class="op">&lt;-</span> <span class="va">models</span><span class="op">$</span><span class="va">avg_ticket_price_pct_capacity</span></span>
<span><span class="va">sub5</span> <span class="op">&lt;-</span> <span class="va">models</span><span class="op">$</span><span class="va">avg_ticket_price_is_dec_or_jan</span></span>
<span><span class="va">sub6</span> <span class="op">&lt;-</span> <span class="va">models</span><span class="op">$</span><span class="va">pct_capacity_is_dec_or_jan</span></span>
<span><span class="va">full</span> <span class="op">&lt;-</span> <span class="va">models</span><span class="op">$</span><span class="va">avg_ticket_price_pct_capacity_is_dec_or_jan</span></span>
<span></span>
<span><span class="va">BF</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BayesFactor.html">BayesFactor</a></span><span class="op">(</span><span class="va">sub1</span>, <span class="va">sub2</span>, <span class="va">sub3</span>, <span class="va">sub4</span>, <span class="va">sub5</span>, <span class="va">sub6</span>, <span class="va">full</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/PostProbMod.html">PostProbMod</a></span><span class="op">(</span><span class="va">BF</span><span class="op">)</span></span>
<span><span class="co">#&gt;          sub1          sub2          sub3          sub4          sub5 </span></span>
<span><span class="co">#&gt;  8.737520e-94 2.373981e-149 4.478599e-212  4.214932e-21  4.594342e-75 </span></span>
<span><span class="co">#&gt;          sub6          full </span></span>
<span><span class="co">#&gt; 2.793475e-131  1.000000e+00</span></span></code></pre></div>
<p><strong>Not surprisingly, the best model is the full model that has
the highest posterior probability of the model. All three predictors are
significant based on posterior distributions.</strong></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">full</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MCMCregress.html">MCMCregress</a></span><span class="op">(</span><span class="va">weekly_gross</span> <span class="op">~</span> <span class="va">avg_ticket_price</span> <span class="op">+</span> <span class="va">pct_capacity</span> <span class="op">+</span> <span class="va">is_dec_or_jan</span>, data <span class="op">=</span> <span class="va">df_bayes</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">full</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Iterations = 1001:11000</span></span>
<span><span class="co">#&gt; Thinning interval = 1 </span></span>
<span><span class="co">#&gt; Number of chains = 1 </span></span>
<span><span class="co">#&gt; Sample size per chain = 10000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 1. Empirical mean and standard deviation for each variable,</span></span>
<span><span class="co">#&gt;    plus standard error of the mean:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                       Mean        SD  Naive SE Time-series SE</span></span>
<span><span class="co">#&gt; (Intercept)      8.696e+05 2.672e+03 2.672e+01      2.672e+01</span></span>
<span><span class="co">#&gt; avg_ticket_price 3.424e+05 2.904e+03 2.904e+01      2.904e+01</span></span>
<span><span class="co">#&gt; pct_capacity     1.462e+05 2.851e+03 2.851e+01      2.775e+01</span></span>
<span><span class="co">#&gt; is_dec_or_jan    1.896e+04 6.368e+03 6.368e+01      6.111e+01</span></span>
<span><span class="co">#&gt; sigma2           9.456e+10 1.053e+09 1.053e+07      1.071e+07</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 2. Quantiles for each variable:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                       2.5%       25%       50%       75%     97.5%</span></span>
<span><span class="co">#&gt; (Intercept)      8.644e+05 8.678e+05 8.696e+05 8.713e+05 8.749e+05</span></span>
<span><span class="co">#&gt; avg_ticket_price 3.367e+05 3.405e+05 3.424e+05 3.444e+05 3.481e+05</span></span>
<span><span class="co">#&gt; pct_capacity     1.405e+05 1.443e+05 1.462e+05 1.481e+05 1.518e+05</span></span>
<span><span class="co">#&gt; is_dec_or_jan    6.582e+03 1.466e+04 1.896e+04 2.326e+04 3.138e+04</span></span>
<span><span class="co">#&gt; sigma2           9.253e+10 9.384e+10 9.455e+10 9.527e+10 9.667e+10</span></span></code></pre></div>
<p><strong>Finally, I plotted the fitted values using Bayesian estimated
coefficients against the true values of weekly gross to evaluate
performance.</strong></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">full</span><span class="op">)</span>, <span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">df_bayes</span><span class="op">$</span><span class="va">fitted</span> <span class="op">&lt;-</span> <span class="va">estimates</span><span class="op">$</span><span class="va">`(Intercept)`</span> <span class="op">+</span> </span>
<span>                   <span class="va">estimates</span><span class="op">$</span><span class="va">avg_ticket_price</span> <span class="op">*</span> <span class="va">df_bayes</span><span class="op">$</span><span class="va">avg_ticket_price</span> <span class="op">+</span></span>
<span>                   <span class="va">estimates</span><span class="op">$</span><span class="va">pct_capacity</span> <span class="op">*</span> <span class="va">df_bayes</span><span class="op">$</span><span class="va">pct_capacity</span> <span class="op">+</span></span>
<span>                   <span class="va">estimates</span><span class="op">$</span><span class="va">is_dec_or_jan</span> <span class="op">*</span> <span class="va">df_bayes</span><span class="op">$</span><span class="va">is_dec_or_jan</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_bayes</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">weekly_gross</span>, y <span class="op">=</span> <span class="va">fitted</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, intercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"blue"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"True value of weekly gross against fitted using Bayesian estimated coefficients"</span>, </span>
<span>       x <span class="op">=</span> <span class="st">"True value"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Fitted value"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Demonstration_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h3>
<p>From this simple analysis, average ticket price, percentage of
theatre capacity (i.e., attendence), and whether the shows are on during
the holiday months can predict weekly box office gross of Broadway
shows. The Bayesian approach provides another point of view to validate
my assumption.</p>
</div>
<div class="section level3">
<h3 id="functions">Functions:<a class="anchor" aria-label="anchor" href="#functions"></a>
</h3>
<ul>
<li>Data wrangling:
<ul>
<li>
<code>dplyr</code>: <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code>, <code><a href="https://rdrr.io/pkg/MASS/man/lm.ridge.html" class="external-link">select()</a></code>,
<code><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange()</a></code>,
<code><a href="https://dplyr.tidyverse.org/reference/recode.html" class="external-link">recode()</a></code>
</li>
<li>
<code>tidyr</code>: <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer()</a></code>
</li>
<li>
<code>lubridate</code>: <code><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year()</a></code>,
<code><a href="https://lubridate.tidyverse.org/reference/month.html" class="external-link">month()</a></code>
</li>
</ul>
</li>
<li>purr: <code><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_dfr()</a></code>, <code><a href="https://purrr.tidyverse.org/reference/modify.html" class="external-link">modify_at()</a></code>,
<code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map()</a></code>
</li>
<li>Plot: <code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line()</a></code>, <code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar()</a></code>,
<code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point()</a></code>, <code><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline()</a></code>,
<code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap()</a></code>
</li>
<li>Package: <code><a href="../reference/MCMCregress.html">MCMCregress()</a></code>, <code><a href="../reference/BayesFactor.html">BayesFactor()</a></code>,
<code><a href="../reference/PostProbMod.html">PostProbMod()</a></code>
</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Website designed by Jianing Yao</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
